# Supervisor configuration for Photo Sorter WASM

[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/nginx.err.log
stdout_logfile=/var/log/supervisor/nginx.out.log
user=root

[program:flask]
command=python /app/backend/app.py
directory=/app/backend
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/flask.err.log
stdout_logfile=/var/log/supervisor/flask.out.log
user=root
environment=PYTHONPATH="/app/backend",FLASK_APP="app.py",FLASK_ENV="production",PORT=5000,HOST=0.0.0.0

# Celery відключено поки що
# [program:celery]
# command=celery -A app.celery worker --loglevel=info
# directory=/app/backend  
# autostart=true
# autorestart=true
# stderr_logfile=/var/log/supervisor/celery.err.log
# stdout_logfile=/var/log/supervisor/celery.out.log
# user=photosorter
# environment=PYTHONPATH="/app/backend"

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
