# Тести для Photo Sorter WASM

Цей файл містить автоматизовані тести для критичних функцій додатку сортування фото.

## Структура тестів

```
tests/
├── setup.js              # Налаштування тестового середовища
├── file-handler.test.js  # Тести для обробки файлів
├── main-app.test.js      # Тести для основного додатку
├── wasm-loader.test.js   # Тести для WASM лоадера
└── integration.test.js   # Інтеграційні тести
```

## Запуск тестів

### Встановлення залежностей
```bash
npm install
```

### Запуск всіх тестів
```bash
npm test
```

### Запуск тестів в режимі спостереження
```bash
npm run test:watch
```

### Запуск тестів з покриттям коду
```bash
npm run test:coverage
```

## Типи тестів

### 1. Unit тести
Перевіряють окремі функції та методи:

- **FileHandler**: Валідація файлів, підтримка форматів, обробка помилок
- **PhotoSorterApp**: Управління налаштуваннями, статистика, інтернаціоналізація
- **WasmLoader**: Завантаження WASM, робота з пам'яттю, обробка зображень

### 2. Інтеграційні тести
Перевіряють взаємодію між компонентами:

- Повний цикл обробки фото
- Синхронізація стану між компонентами
- Обробка каскадних помилок
- Продуктивність при великих обсягах даних

## Покриття коду

Тести покривають:
- ✅ 70%+ гілок коду
- ✅ 70%+ функцій
- ✅ 70%+ рядків коду
- ✅ 70%+ операторів

## Критичні функції

### Валідація файлів
```javascript
test('має правильно визначати підтримувані формати', () => {
    expect(fileHandler.isImageFile('photo.jpg')).toBe(true);
    expect(fileHandler.isImageFile('document.txt')).toBe(false);
});
```

### Обробка помилок
```javascript
test('має правильно обробляти помилки WASM', async () => {
    await expect(wasmLoader.load()).rejects.toThrow('WASM load failed');
});
```

### Продуктивність
```javascript
test('має правильно обробляти велику кількість файлів', () => {
    const startTime = Date.now();
    // ... обробка 1000 файлів
    const endTime = Date.now();
    expect(endTime - startTime).toBeLessThan(1000);
});
```

## Безпека

Тести перевіряють:
- Валідацію вхідних даних
- Захист від XSS атак
- Захист від SQL ін'єкцій
- Обробку неочікуваних типів даних

## Налаштування

### Jest конфігурація
```javascript
module.exports = {
  testEnvironment: 'jsdom',
  testMatch: ['**/__tests__/**/*.js', '**/?(*.)+(spec|test).js'],
  collectCoverageFrom: ['js/**/*.js'],
  coverageThreshold: {
    global: {
      branches: 70,
      functions: 70,
      lines: 70,
      statements: 70
    }
  }
};
```

### Тестове середовище
- Імітує браузерні API (File System Access, WebAssembly)
- Налаштовує моки для зовнішніх залежностей
- Забезпечує ізоляцію тестів

## Додавання нових тестів

### Структура тесту
```javascript
describe('Новий компонент', () => {
    let component;

    beforeEach(() => {
        component = new NewComponent();
    });

    test('має правильно працювати', () => {
        expect(component.doSomething()).toBe(true);
    });
});
```

### Найкращі практики
1. **Один тест - одна перевірка**
2. **Описові назви тестів**
3. **Ізоляція тестів**
4. **Моки для зовнішніх залежностей**
5. **Перевірка як успішних, так і помилкових сценаріїв**

## Відладка тестів

### Запуск окремого тесту
```bash
npm test -- --testNamePattern="має правильно визначати підтримувані формати"
```

### Детальний вивід
```bash
npm test -- --verbose
```

### Зупинка на першій помилці
```bash
npm test -- --bail
```

## CI/CD

Тести автоматично запускаються при:
- Push до репозиторію
- Створенні Pull Request
- Ручному запуску в GitHub Actions

## Підтримка

Якщо тести не проходять:
1. Перевірте консоль на помилки
2. Переконайтеся, що всі залежності встановлені
3. Перевірте налаштування Jest
4. Створіть Issue з деталями помилки
